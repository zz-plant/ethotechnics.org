---
import PageIntro from '../../components/PageIntro.astro';
import BaseLayout from '../../layouts/BaseLayout.astro';
import CardGrid from '../../components/CardGrid.astro';
import CardItem from '../../components/CardItem.astro';
import SectionBlock from '../../components/SectionBlock.astro';
import { getGlossaryLabel, glossaryContent } from '../../content/glossary';
import { researchContent } from '../../content/research';

const { pageTitle, pageDescription, permalink, agenda, focusAreas, publications, lastUpdated, updateCadence } =
  researchContent;
const glossaryBase = glossaryContent.permalink;
const glossaryHref = (slug: string) => `${glossaryBase}#${slug}`;
---
<BaseLayout title={pageTitle} description={pageDescription}>
  <PageIntro
    eyebrow="Research"
    title="Research"
    description={pageDescription}
    permalink={permalink}
    anchorLinks={[
      { href: '#orientation', label: 'Orientation' },
      { href: '#agenda', label: 'Agenda' },
      { href: '#focus-areas', label: 'Focus areas' },
      { href: '#publications', label: 'Publications' },
    ]}
    panelCopy={{
      eyebrow: 'How to read these entries',
      title: 'Cross-linked with the Library glossary.',
      description:
        'Agenda items, focus areas, and publications link back to glossary anchors so readers share the same definitions. Use them when citing Field Notes or diagnostics results to keep language consistent.',
    }}
  />
  <p class="muted small">
    Last updated {new Date(lastUpdated).toLocaleDateString('en-US', { month: 'short', year: 'numeric' })}.{' '}
    {updateCadence}
  </p>

  <SectionBlock
    id="orientation"
    eyebrow="Orientation"
    title="How we run the work."
    description="The research backlog combines field-ready protocols with governance anchors so findings travel cleanly into diagnostics and delivery."
    className="section--banded"
  >
    <CardGrid className="grid--two research__grid">
      <CardItem
        title="Protocols with receipts"
        description="Shared prompt packs and facilitation notes keep teams aligned when fielding interviews or co-design sessions."
        tags={["Participatory methods", "Plain-language scripts", "Reusable consent" ]}
      />
      <CardItem
        title="Decisions we can cite"
        description="Every study ties to glossary anchors and decision logs, making it easy to reference the why behind research calls."
        tags={["Glossary-linked", "Decision hygiene", "Traceable handoffs"]}
      />
      <CardItem
        title="Signals into diagnostics"
        description="Focus areas flow into readiness labs so partners see risk levels, escalation paths, and facilitation options in one place."
        tags={["Readiness labs", "Risk surfaced early", "Studio handoffs"]}
      />
    </CardGrid>
  </SectionBlock>

  <SectionBlock
    id="agenda"
    eyebrow="Agenda"
    title="In-flight lines of inquiry."
    description="Each line links to glossary terms you can reference in protocols and design docs."
    variant="alt"
  >
    <CardGrid>
      {agenda.map((item) => (
        <CardItem
          meta={item.timeframe}
          title={item.title}
          tags={item.goals}
          glossaryLinks={item.glossaryRefs.map((slug) => ({
            href: glossaryHref(slug),
            label: getGlossaryLabel(slug),
          }))}
        />
      ))}
    </CardGrid>
  </SectionBlock>

  <SectionBlock
    id="focus-areas"
    eyebrow="Focus areas"
    title="Where we spend our attention."
    description="Use these anchors to align research, Field Notes, and diagnostics around the same questions."
  >
    <CardGrid>
      {focusAreas.map((area) => (
        <CardItem
          id={area.slug}
          title={area.title}
          description={area.description}
          tags={area.questions}
          glossaryLinks={area.glossaryRefs.map((slug) => ({
            href: glossaryHref(slug),
            label: getGlossaryLabel(slug),
          }))}
        />
      ))}
    </CardGrid>
  </SectionBlock>

  <SectionBlock
    id="publications"
    eyebrow="Publications"
    title="Protocols, decks, and reports."
    description="Each entry is tagged with glossary links to help readers dig deeper in the Library."
    variant="alt"
  >
    <CardGrid>
      {publications.map((publication) => (
        <CardItem
          meta={publication.type}
          title={publication.title}
          description={publication.summary}
          descriptionTone="default"
          tags={publication.tags}
          glossaryLinks={publication.glossaryRefs.map((slug) => ({
            href: glossaryHref(slug),
            label: getGlossaryLabel(slug),
          }))}
        />
      ))}
    </CardGrid>
  </SectionBlock>
</BaseLayout>
