---
import PageIntro from "../../components/PageIntro.astro";
import BaseLayout from "../../layouts/BaseLayout.astro";
import CardGrid from "../../components/CardGrid.astro";
import CardItem from "../../components/CardItem.astro";
import SectionBlock from "../../components/SectionBlock.astro";
import { getGlossaryLabel, glossaryPermalink } from "../../utils/glossary";
import { researchContent } from "../../content/research";

const {
  pageTitle,
  pageDescription,
  permalink,
  anchorLinks,
  panelCopy,
  orientationCards,
  agenda,
  focusAreas,
  publications,
  lastUpdated,
  updateCadence,
} = researchContent;
const glossaryBase = glossaryPermalink;
const glossaryHref = (slug: string) => `${glossaryBase}#${slug}`;
---

<BaseLayout title={pageTitle} description={pageDescription}>
  <PageIntro
    eyebrow="Research"
    title="Research"
    description={pageDescription}
    permalink={permalink}
    anchorLinks={anchorLinks}
    panelCopy={panelCopy}
  />
  <p class="muted small">
    Last updated {
      new Date(lastUpdated).toLocaleDateString("en-US", {
        month: "short",
        year: "numeric",
      })
    }.{" "}
    {updateCadence}
  </p>

  <SectionBlock
    id="orientation"
    eyebrow="Orientation"
    title="How we run the work."
    description="The research backlog combines field-ready protocols with governance anchors so findings travel cleanly into diagnostics and delivery."
    className="section--banded"
  >
    <CardGrid className="grid--two research__grid">
      {
        orientationCards.map((card) => (
          <CardItem
            title={card.title}
            description={card.description}
            tags={card.tags}
          />
        ))
      }
    </CardGrid>
  </SectionBlock>

  <SectionBlock
    id="agenda"
    eyebrow="Agenda"
    title="In-flight lines of inquiry."
    description="Each line links to glossary terms you can reference in protocols and design docs."
    variant="alt"
  >
    <CardGrid>
      {
        agenda.map((item) => (
          <CardItem
            meta={item.timeframe}
            title={item.title}
            tags={item.goals}
            glossaryLinks={item.glossaryRefs.map((slug) => ({
              href: glossaryHref(slug),
              label: getGlossaryLabel(slug),
            }))}
          />
        ))
      }
    </CardGrid>
  </SectionBlock>

  <SectionBlock
    id="focus-areas"
    eyebrow="Focus areas"
    title="Where we spend our attention."
    description="Use these anchors to align research, Field Notes, and diagnostics around the same questions."
  >
    <CardGrid>
      {
        focusAreas.map((area) => (
          <CardItem
            id={area.slug}
            title={area.title}
            description={area.description}
            tags={area.questions}
            glossaryLinks={area.glossaryRefs.map((slug) => ({
              href: glossaryHref(slug),
              label: getGlossaryLabel(slug),
            }))}
          />
        ))
      }
    </CardGrid>
  </SectionBlock>

  <SectionBlock
    id="publications"
    eyebrow="Publications"
    title="Protocols, decks, and reports."
    description="Each entry is tagged with glossary links to help readers dig deeper in the Library."
    variant="alt"
  >
    <CardGrid>
      {
        publications.map((publication) => (
          <CardItem
            meta={publication.type}
            title={publication.title}
            description={publication.summary}
            descriptionTone="default"
            tags={publication.tags}
            glossaryLinks={publication.glossaryRefs.map((slug) => ({
              href: glossaryHref(slug),
              label: getGlossaryLabel(slug),
            }))}
          >
            <div slot="footer" class="card__footer">
              <a class="button ghost button--compact" href={publication.href}>
                {publication.ctaLabel}
              </a>
            </div>
          </CardItem>
        ))
      }
    </CardGrid>
  </SectionBlock>
</BaseLayout>
