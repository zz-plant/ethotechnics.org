---
import PageIntro from '../../components/PageIntro.astro';
import BaseLayout from '../../layouts/BaseLayout.astro';
import { libraryContent } from '../../content/library';
import { researchContent } from '../../content/research';

const { pageTitle, pageDescription, permalink, agenda, focusAreas, publications } = researchContent;
const glossaryBase = libraryContent.permalink;
const glossaryHref = (slug: string) => `${glossaryBase}#${slug}`;
const formatTerm = (slug: string) =>
  slug
    .split('-')
    .map((part) => part.charAt(0).toUpperCase() + part.slice(1))
    .join(' ');
---
<BaseLayout title={pageTitle} description={pageDescription}>
  <PageIntro
    eyebrow="Research"
    title="Research"
    description={pageDescription}
    permalink={permalink}
    anchorLinks={[
      { href: '#agenda', label: 'Agenda' },
      { href: '#focus-areas', label: 'Focus areas' },
      { href: '#publications', label: 'Publications' },
    ]}
    panelCopy={{
      eyebrow: 'How to read these entries',
      title: 'Cross-linked with the Library glossary.',
      description:
        'Agenda items, focus areas, and publications link back to glossary anchors so readers share the same definitions. Use them when citing Field Notes or diagnostics results to keep language consistent.',
    }}
  />

  <section id="agenda" class="section section--alt">
    <div class="section__header">
      <p class="eyebrow">Agenda</p>
      <h2>In-flight lines of inquiry.</h2>
      <p class="muted">
        Each line links to glossary terms you can reference in protocols and design docs.
      </p>
    </div>
    <div class="grid">
      {agenda.map((item) => (
        <article class="card">
          <div class="card__glow" aria-hidden="true" />
          <p class="muted">{item.timeframe}</p>
          <h3>{item.title}</h3>
          <ul class="pill-list">
            {item.goals.map((goal) => (
              <li>{goal}</li>
            ))}
          </ul>
          <p class="muted">
            Glossary:{' '}
            {item.glossaryRefs.map((slug, index) => {
              const separator = index < item.glossaryRefs.length - 1 ? ', ' : '';

              return (
                <>
                  <a href={glossaryHref(slug)}>{formatTerm(slug)}</a>
                  {separator}
                </>
              );
            })}
          </p>
        </article>
      ))}
    </div>
  </section>

  <section id="focus-areas" class="section">
    <div class="section__header">
      <p class="eyebrow">Focus areas</p>
      <h2>Where we spend our attention.</h2>
      <p class="muted">
        Use these anchors to align research, Field Notes, and diagnostics around the same questions.
      </p>
    </div>
    <div class="grid">
      {focusAreas.map((area) => (
        <article class="card" id={area.slug}>
          <div class="card__glow" aria-hidden="true" />
          <h3>{area.title}</h3>
          <p class="muted">{area.description}</p>
          <ul class="pill-list">
            {area.questions.map((question) => (
              <li>{question}</li>
            ))}
          </ul>
          <p class="muted">
            Glossary:{' '}
            {area.glossaryRefs.map((slug, index) => {
              const separator = index < area.glossaryRefs.length - 1 ? ', ' : '';

              return (
                <>
                  <a href={glossaryHref(slug)}>{formatTerm(slug)}</a>
                  {separator}
                </>
              );
            })}
          </p>
        </article>
      ))}
    </div>
  </section>

  <section id="publications" class="section section--alt">
    <div class="section__header">
      <p class="eyebrow">Publications</p>
      <h2>Protocols, decks, and reports.</h2>
      <p class="muted">
        Each entry is tagged with glossary links to help readers dig deeper in the Library.
      </p>
    </div>
    <div class="grid">
      {publications.map((publication) => (
        <article class="card">
          <div class="card__glow" aria-hidden="true" />
          <p class="muted">{publication.type}</p>
          <h3>{publication.title}</h3>
          <p>{publication.summary}</p>
          <ul class="pill-list">
            {publication.tags.map((tag) => (
              <li>{tag}</li>
            ))}
          </ul>
          <p class="muted">
            Glossary:{' '}
            {publication.glossaryRefs.map((slug, index) => {
              const separator = index < publication.glossaryRefs.length - 1 ? ', ' : '';

              return (
                <>
                  <a href={glossaryHref(slug)}>{formatTerm(slug)}</a>
                  {separator}
                </>
              );
            })}
          </p>
        </article>
      ))}
    </div>
  </section>
</BaseLayout>
