---
import PageIntro from '../../components/PageIntro.astro';
import BaseLayout from '../../layouts/BaseLayout.astro';
import CardGrid from '../../components/CardGrid.astro';
import CardItem from '../../components/CardItem.astro';
import SectionBlock from '../../components/SectionBlock.astro';
import { libraryContent } from '../../content/library';
import { researchContent } from '../../content/research';

const { pageTitle, pageDescription, permalink, agenda, focusAreas, publications } = researchContent;
const glossaryBase = libraryContent.permalink;
const glossaryHref = (slug: string) => `${glossaryBase}#${slug}`;
const formatTerm = (slug: string) =>
  slug
    .split('-')
    .map((part) => part.charAt(0).toUpperCase() + part.slice(1))
    .join(' ');
---
<BaseLayout title={pageTitle} description={pageDescription}>
  <PageIntro
    eyebrow="Research"
    title="Research"
    description={pageDescription}
    permalink={permalink}
    anchorLinks={[
      { href: '#agenda', label: 'Agenda' },
      { href: '#focus-areas', label: 'Focus areas' },
      { href: '#publications', label: 'Publications' },
    ]}
    panelCopy={{
      eyebrow: 'How to read these entries',
      title: 'Cross-linked with the Library glossary.',
      description:
        'Agenda items, focus areas, and publications link back to glossary anchors so readers share the same definitions. Use them when citing Field Notes or diagnostics results to keep language consistent.',
    }}
  />

  <SectionBlock
    id="agenda"
    eyebrow="Agenda"
    title="In-flight lines of inquiry."
    description="Each line links to glossary terms you can reference in protocols and design docs."
    variant="alt"
  >
    <CardGrid>
      {agenda.map((item) => (
        <CardItem
          meta={item.timeframe}
          title={item.title}
          tags={item.goals}
          glossaryLinks={item.glossaryRefs.map((slug) => ({
            href: glossaryHref(slug),
            label: formatTerm(slug),
          }))}
        />
      ))}
    </CardGrid>
  </SectionBlock>

  <SectionBlock
    id="focus-areas"
    eyebrow="Focus areas"
    title="Where we spend our attention."
    description="Use these anchors to align research, Field Notes, and diagnostics around the same questions."
  >
    <CardGrid>
      {focusAreas.map((area) => (
        <CardItem
          id={area.slug}
          title={area.title}
          description={area.description}
          tags={area.questions}
          glossaryLinks={area.glossaryRefs.map((slug) => ({
            href: glossaryHref(slug),
            label: formatTerm(slug),
          }))}
        />
      ))}
    </CardGrid>
  </SectionBlock>

  <SectionBlock
    id="publications"
    eyebrow="Publications"
    title="Protocols, decks, and reports."
    description="Each entry is tagged with glossary links to help readers dig deeper in the Library."
    variant="alt"
  >
    <CardGrid>
      {publications.map((publication) => (
        <CardItem
          meta={publication.type}
          title={publication.title}
          description={publication.summary}
          descriptionTone="default"
          tags={publication.tags}
          glossaryLinks={publication.glossaryRefs.map((slug) => ({
            href: glossaryHref(slug),
            label: formatTerm(slug),
          }))}
        />
      ))}
    </CardGrid>
  </SectionBlock>
</BaseLayout>
