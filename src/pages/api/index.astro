---
import BaseLayout from "../../layouts/BaseLayout.astro";
import PageIntro from "../../components/PageIntro.astro";
import SectionBlock from "../../components/SectionBlock.astro";

const pageTitle = "Reference API & ontology";
const pageDescription =
  "Canonical objects and a read-only API plan for consuming Ethotechnics standards in tools and audits.";
const permalink = "/api";
const anchorLinks = [
  { href: "#objects", label: "Canonical objects" },
  { href: "#agent-model", label: "Agent object model" },
  { href: "#endpoints", label: "Read-only endpoints" },
  { href: "#versioning", label: "Versioning" },
  { href: "#interop", label: "Interoperability stack" },
  { href: "#roadmap", label: "Roadmap" },
];

const canonicalObjects = [
  {
    name: "Standard",
    description: "Top-level standard metadata, version, and published clauses.",
  },
  {
    name: "Clause",
    description: "Atomic right requirement with a stable clause ID (e.g., \u00a73.2).",
  },
  {
    name: "Mechanism",
    description: "Reusable enforcement spec with tags, artifacts, and implementation notes.",
  },
  {
    name: "Validator",
    description: "Diagnostic definition with inputs, thresholds, and output schema.",
  },
  {
    name: "Finding",
    description: "Canonical diagnostic artifact linking gaps to clauses and fixes.",
  },
  {
    name: "Diagnostic result",
    description: "Generated report card, risk statement, and remediation recommendations.",
  },
  {
    name: "Evidence pack",
    description: "Minimum evidence bundles required to verify clause compliance.",
  },
  {
    name: "Anti-pattern",
    description: "Negative examples that look compliant but fail the clause intent.",
  },
  {
    name: "Diagram",
    description: "Diagram objects aligned to the micro-diagram language spec.",
  },
  {
    name: "Agent safety object model",
    description:
      "Machine-readable profile for autonomy level, action classes, override authority, and receipts.",
  },
];

const endpoints = [
  {
    path: "/api/agent-index.json",
    description: "Quick-start index for agent discovery and tooling.",
  },
  {
    path: "/api/site-index.json",
    description: "Index of standards, validators, and research metadata.",
  },
  {
    path: "/api/standards.json",
    description: "Standard metadata with embedded clause objects.",
  },
  {
    path: "/api/clauses.json",
    description: "Clause-level obligations with evidence requirements and mappings.",
  },
  {
    path: "/api/mechanisms.json",
    description: "Mechanism catalog entries with filters and citations.",
  },
  {
    path: "/api/validators.json",
    description: "Validator definitions with inputs, thresholds, and clause mappings.",
  },
  {
    path: "/api/anti-patterns.json",
    description: "Negative patterns that surface legitimacy theater risks.",
  },
  {
    path: "/api/evidence-packs.json",
    description: "Evidence pack templates per clause.",
  },
  {
    path: "/api/findings.json",
    description: "Canonical finding objects for remediation workflows.",
  },
  {
    path: "/api/diagnostic-results.json",
    description: "Portable diagnostic result artifacts.",
  },
  {
    path: "/api/rag-corpus.jsonl?limit=200",
    description:
      "JSONL corpus for retrieval pipelines (add a limit query param for previews).",
  },
  {
    path: "/api/glossary.json",
    description: "Glossary terms with permalinks.",
  },
  {
    path: "/api/research.json",
    description: "Research publications and bridge artifacts.",
  },
  {
    path: "/api/releases.json",
    description: "Versioned release index for stable citations.",
  },
  {
    path: "/api/v/2026.01/",
    description: "Versioned snapshot endpoints for reproducible analysis.",
  },
];
---

<BaseLayout title={`${pageTitle} â€” Ethotechnics`} description={pageDescription} mainClass="page page--wide">
  <PageIntro
    eyebrow="Reference API"
    title={pageTitle}
    description={pageDescription}
    permalink={permalink}
    anchorLinks={anchorLinks}
    panelCopy={{
      eyebrow: "Machine-readable",
      title: "Plan for programmatic access.",
      description:
        "The goal is a stable object model that tools can cite, cache, and validate against.",
    }}
  />

  <SectionBlock
    id="objects"
    eyebrow="Canonical objects"
    title="The object model this API will publish."
    description="Use these names in integrations and audit tooling."
  >
    <ul class="muted">
      {canonicalObjects.map((object) => (
        <li>
          <strong>{object.name}:</strong> {object.description}
        </li>
      ))}
    </ul>
  </SectionBlock>

  <SectionBlock
    id="agent-model"
    eyebrow="Agent object model"
    title="Agent Safety Object Model"
    description="Publish a machine-readable profile for agent governance in tooling."
    variant="alt"
  >
    <ul class="muted">
      <li>
        Spec page:
        {" "}
        <a href="/agents/spec">/agents/spec</a>
      </li>
      <li>
        JSON schema:
        {" "}
        <a href="/agents/spec.json">/agents/spec.json</a>
      </li>
    </ul>
  </SectionBlock>

  <SectionBlock
    id="endpoints"
    eyebrow="Read-only endpoints"
    title="Current machine-readable exports."
    description="These endpoints are stable exports for tooling, audits, and archival use."
    variant="alt"
  >
    <div class="mapping-table__wrapper">
      <table class="mapping-table">
        <thead>
          <tr>
            <th scope="col">Endpoint</th>
            <th scope="col">Purpose</th>
          </tr>
        </thead>
        <tbody>
          {endpoints.map((endpoint) => (
            <tr>
              <td>
                <a href={endpoint.path}>{endpoint.path}</a>
              </td>
              <td>{endpoint.description}</td>
            </tr>
          ))}
        </tbody>
      </table>
    </div>
  </SectionBlock>

  <SectionBlock
    id="versioning"
    eyebrow="Versioning"
    title="Versioned citations stay stable."
    description="Each object should carry a version, updated timestamp, and canonical permalink."
  >
    <ul class="muted">
      <li>Semantic versioning for standards, mechanisms, and validators.</li>
      <li>Immutable permalinks for citations in contracts and audit logs.</li>
      <li>Changelogs that describe material changes to rights or thresholds.</li>
      <li>Snapshot endpoints under /api/v/ to pin analyses in time.</li>
    </ul>
  </SectionBlock>

  <SectionBlock
    id="interop"
    eyebrow="Interoperability stack"
    title="Make Ethotechnics adoptable across governance toolchains."
    description="Ship boring, legible formats before bespoke platforms or DSLs."
  >
    <div class="grid">
      <div>
        <h3>Schema ports and plugs</h3>
        <ul class="muted">
          <li>decision-record.schema.json</li>
          <li>appeal-event.schema.json</li>
          <li>pause-reversal.schema.json</li>
          <li>burden-hours.schema.json</li>
          <li>repair-sla.schema.json</li>
        </ul>
      </div>
      <div>
        <h3>Exchange standards</h3>
        <ul class="muted">
          <li>OpenAPI control-plane definitions for read/write inspection.</li>
          <li>AsyncAPI event schemas for denials, appeals, and SLA breaches.</li>
          <li>FHIR profiles for healthcare decision, appeal, and repair status.</li>
          <li>W3C Verifiable Credentials for portable proof of rights and compliance.</li>
        </ul>
      </div>
      <div>
        <h3>Reference tooling</h3>
        <ul class="muted">
          <li>Python validators, time-in-harm calculators, and clause mapping evaluators.</li>
          <li>TypeScript SDKs for event emission, middleware, and dashboard-safe types.</li>
          <li>Markdown-to-PDF, CSV, and spreadsheet exports for auditors.</li>
        </ul>
      </div>
    </div>
  </SectionBlock>

  <SectionBlock
    id="roadmap"
    eyebrow="Roadmap"
    title="Prioritized release sequence."
    description="Release order favors auditability, interoperability, and institutional adoption."
    variant="alt"
  >
    <ul class="muted">
      <li>JSON schemas + YAML specs for evidence artifacts and control definitions.</li>
      <li>OpenAPI + AsyncAPI definitions for system-to-system interoperability.</li>
      <li>Python evaluation toolkit for auditors and researchers.</li>
      <li>TypeScript SDK and middleware for product integrations.</li>
      <li>Domain extensions (FHIR profiles, verifiable credentials).</li>
      <li>Signed releases with verifiable citation hashes.</li>
    </ul>
  </SectionBlock>
</BaseLayout>
