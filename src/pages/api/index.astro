---
import BaseLayout from "../../layouts/BaseLayout.astro";
import PageIntro from "../../components/PageIntro.astro";
import SectionBlock from "../../components/SectionBlock.astro";

const pageTitle = "Reference API & ontology";
const pageDescription =
  "Canonical objects and a read-only API plan for consuming Ethotechnics standards in tools and audits.";
const permalink = "/api";
const anchorLinks = [
  { href: "#objects", label: "Canonical objects" },
  { href: "#interoperability", label: "Interoperability specs" },
  { href: "#agent-model", label: "Agent object model" },
  { href: "#endpoints", label: "Read-only endpoints" },
  { href: "#versioning", label: "Versioning" },
  { href: "#roadmap", label: "Roadmap" },
];

const canonicalObjects = [
  {
    name: "Standard",
    description: "Top-level standard metadata, version, and published clauses.",
  },
  {
    name: "Clause",
    description: "Atomic right requirement with a stable clause ID (e.g., \u00a73.2).",
  },
  {
    name: "Mechanism",
    description: "Reusable enforcement spec with tags, artifacts, and implementation notes.",
  },
  {
    name: "Validator",
    description: "Diagnostic definition with inputs, thresholds, and output schema.",
  },
  {
    name: "Finding",
    description: "Canonical diagnostic artifact linking gaps to clauses and fixes.",
  },
  {
    name: "Diagnostic result",
    description: "Generated report card, risk statement, and remediation recommendations.",
  },
  {
    name: "Evidence pack",
    description: "Minimum evidence bundles required to verify clause compliance.",
  },
  {
    name: "Anti-pattern",
    description: "Negative examples that look compliant but fail the clause intent.",
  },
  {
    name: "Diagram",
    description: "Diagram objects aligned to the micro-diagram language spec.",
  },
  {
    name: "Agent safety object model",
    description:
      "Machine-readable profile for autonomy level, action classes, override authority, and receipts.",
  },
];

const interoperabilitySpecs = [
  {
    name: "Control plane OpenAPI",
    href: "/standards/ethotechnics-control-plane.openapi.yaml",
    description:
      "Decision retrieval and appeal intake endpoints aligned to the agent receipt schema.",
  },
  {
    name: "Events AsyncAPI",
    href: "/standards/ethotechnics-events.asyncapi.yaml",
    description:
      "Deadline and repair log events for clocked governance and remediation workflows.",
  },
];

const endpoints = [
  {
    path: "/api/agent-index.json",
    description: "Quick-start index for agent discovery and tooling.",
  },
  {
    path: "/api/site-index.json",
    description: "Index of standards, validators, and research metadata.",
  },
  {
    path: "/api/standards.json",
    description: "Standard metadata with embedded clause objects.",
  },
  {
    path: "/api/clauses.json",
    description: "Clause-level obligations with evidence requirements and mappings.",
  },
  {
    path: "/api/mechanisms.json",
    description: "Mechanism catalog entries with filters and citations.",
  },
  {
    path: "/api/validators.json",
    description: "Validator definitions with inputs, thresholds, and clause mappings.",
  },
  {
    path: "/api/anti-patterns.json",
    description: "Negative patterns that surface legitimacy theater risks.",
  },
  {
    path: "/api/evidence-packs.json",
    description: "Evidence pack templates per clause.",
  },
  {
    path: "/api/findings.json",
    description: "Canonical finding objects for remediation workflows.",
  },
  {
    path: "/api/diagnostic-results.json",
    description: "Portable diagnostic result artifacts.",
  },
  {
    path: "/api/rag-corpus.jsonl?limit=200",
    description:
      "JSONL corpus for retrieval pipelines (add a limit query param for previews).",
  },
  {
    path: "/api/glossary.json",
    description: "Glossary terms with permalinks.",
  },
  {
    path: "/api/research.json",
    description: "Research publications and bridge artifacts.",
  },
  {
    path: "/api/releases.json",
    description: "Versioned release index for stable citations.",
  },
  {
    path: "/api/v/2026.01/",
    description: "Versioned snapshot endpoints for reproducible analysis.",
  },
];
---

<BaseLayout title={`${pageTitle} — Ethotechnics`} description={pageDescription} mainClass="page page--wide">
  <PageIntro
    eyebrow="Reference API"
    title={pageTitle}
    description={pageDescription}
    permalink={permalink}
    anchorLinks={anchorLinks}
    panelCopy={{
      eyebrow: "Machine-readable",
      title: "Plan for programmatic access.",
      description:
        "The goal is a stable object model that tools can cite, cache, and validate against.",
    }}
  />

  <SectionBlock
    id="objects"
    eyebrow="Canonical objects"
    title="The object model this API will publish."
    description="Use these names in integrations and audit tooling."
  >
    <ul class="muted">
      {canonicalObjects.map((object) => (
        <li>
          <strong>{object.name}:</strong> {object.description}
        </li>
      ))}
    </ul>
  </SectionBlock>

  <SectionBlock
    id="interoperability"
    eyebrow="Interoperability specs"
    title="Draft contracts for decision and repair workflows."
    description="Use these specs to wire decisions, appeals, and clock events into tooling."
  >
    <ul class="muted">
      {interoperabilitySpecs.map((spec) => (
        <li>
          <strong>{spec.name}:</strong>{" "}
          <a href={spec.href}>{spec.href}</a> — {spec.description}
        </li>
      ))}
    </ul>
    <div>
      <p class="eyebrow">FHIR resources</p>
      <h3>FHIR Resources (healthcare-specific interop)</h3>
      <ul class="muted">
        <li>
          <strong>Target:</strong> healthcare payers, providers, regulators.
        </li>
        <li>If you care about healthcare, this is non-optional.</li>
        <li>
          <strong>Why:</strong> FHIR is the only sanctioned exchange substrate in
          U.S. health. TEFCA rides on top of it.
        </li>
        <li>
          <strong>What to ship:</strong> custom FHIR profiles for:
          <ul>
            <li>Decision</li>
            <li>Denial</li>
            <li>Appeal</li>
            <li>RepairStatus</li>
            <li>PendingClock</li>
          </ul>
        </li>
        <li>FHIR makes refusal + repair first-class healthcare data.</li>
      </ul>
    </div>
    <ul class="muted">
      <li>
        Decision retrieval: <code>GET /api/decisions/{`{decision_id}`}</code>
      </li>
      <li>Appeal submission: <code>POST /api/appeals</code></li>
      <li>
        Events: <code>decision.deadline.reminder</code>,{" "}
        <code>appeal.deadline.breached</code>,{" "}
        <code>repair.log.updated</code>
      </li>
    </ul>
  </SectionBlock>

  <SectionBlock
    id="agent-model"
    eyebrow="Agent object model"
    title="Agent Safety Object Model"
    description="Publish a machine-readable profile for agent governance in tooling."
    variant="alt"
  >
    <ul class="muted">
      <li>
        Spec page:
        {" "}
        <a href="/agents/spec">/agents/spec</a>
      </li>
      <li>
        JSON schema:
        {" "}
        <a href="/agents/spec.json">/agents/spec.json</a>
      </li>
      <li>
        Receipt and remedy schemas:
        <ul>
          <li>
            <a href="/standards/agent-receipt-schema.json">/standards/agent-receipt-schema.json</a>
          </li>
          <li>
            <a href="/standards/decision-record.schema.json">/standards/decision-record.schema.json</a>
          </li>
          <li>
            <a href="/standards/appeal-event.schema.json">/standards/appeal-event.schema.json</a>
          </li>
          <li>
            <a href="/standards/pause-reversal.schema.json">/standards/pause-reversal.schema.json</a>
          </li>
          <li>
            <a href="/standards/burden-hours.schema.json">/standards/burden-hours.schema.json</a>
          </li>
          <li>
            <a href="/standards/repair-sla.schema.json">/standards/repair-sla.schema.json</a>
          </li>
        </ul>
      </li>
    </ul>
  </SectionBlock>

  <SectionBlock
    id="endpoints"
    eyebrow="Read-only endpoints"
    title="Current machine-readable exports."
    description="These endpoints are stable exports for tooling, audits, and archival use."
    variant="alt"
  >
    <div class="mapping-table__wrapper">
      <table class="mapping-table">
        <thead>
          <tr>
            <th scope="col">Endpoint</th>
            <th scope="col">Purpose</th>
          </tr>
        </thead>
        <tbody>
          {endpoints.map((endpoint) => (
            <tr>
              <td>
                <a href={endpoint.path}>{endpoint.path}</a>
              </td>
              <td>{endpoint.description}</td>
            </tr>
          ))}
        </tbody>
      </table>
    </div>
  </SectionBlock>

  <SectionBlock
    id="versioning"
    eyebrow="Versioning"
    title="Versioned citations stay stable."
    description="Each object should carry a version, updated timestamp, and canonical permalink."
  >
    <ul class="muted">
      <li>Semantic versioning for standards, mechanisms, and validators.</li>
      <li>Immutable permalinks for citations in contracts and audit logs.</li>
      <li>Changelogs that describe material changes to rights or thresholds.</li>
      <li>Snapshot endpoints under /api/v/ to pin analyses in time.</li>
    </ul>
  </SectionBlock>

  <SectionBlock
    id="roadmap"
    eyebrow="Roadmap"
    title="Planned additions."
    description="The next phase expands coverage and release automation."
    variant="alt"
  >
    <ul class="muted">
      <li>Signed releases with verifiable citation hashes.</li>
      <li>Schema validation automation for new objects.</li>
      <li>Expanded clause mapping for emerging standards.</li>
      <li>OpenAPI draft for decision retrieval and appeal intake.</li>
      <li>AsyncAPI events for deadline clocks and repair log updates.</li>
    </ul>
  </SectionBlock>
</BaseLayout>
