---
import BaseLayout from "../../layouts/BaseLayout.astro";
import PageIntro from "../../components/PageIntro.astro";
import CardGrid from "../../components/CardGrid.astro";
import CardItem from "../../components/CardItem.astro";
import SummaryCallout from "../../components/SummaryCallout.astro";
import SectionBlock from "../../components/SectionBlock.astro";
import { validatorsContent } from "../../content/validators";

const {
  pageTitle,
  pageDescription,
  permalink,
  anchorLinks,
  panelCopy,
  validators,
  method,
} = validatorsContent;
const featuredValidators = validators.slice(0, 2);
const focusGroups = [
  {
    title: "Time burden & friction",
    description:
      "Validators that surface constructive denial and high-friction risk.",
    validators: validators.slice(0, 2),
  },
  {
    title: "Latency & bounded duration",
    description: "Validators that confirm time limits and escalation readiness.",
    validators: validators.slice(2, 3),
  },
];
const { cspNonce } = Astro.locals;
const pageUrl = Astro.site
  ? new URL(permalink, Astro.site).toString()
  : permalink;
const validatorUrl = (slug: string) =>
  Astro.site
    ? new URL(`/validators/${slug}`, Astro.site).toString()
    : `/validators/${slug}`;
const structuredData = {
  "@context": "https://schema.org",
  "@type": "CollectionPage",
  "@id": pageUrl,
  name: pageTitle,
  description: pageDescription,
  url: pageUrl,
  hasPart: validators.map((validator) => ({
    "@type": "CreativeWork",
    name: `${validator.id} â€” ${validator.title}`,
    description: validator.description,
    url: validatorUrl(validator.slug),
    identifier: validator.id,
  })),
};
const structuredDataJson = JSON.stringify(structuredData, null, 2);
---

<BaseLayout title={pageTitle} description={pageDescription}>
  <PageIntro
    eyebrow="Validators"
    title="Validators"
    description="Run diagnostic validators that output report cards and corrective mechanisms."
    permalink={permalink}
    anchorLinks={anchorLinks}
    panelCopy={panelCopy}
  >
    <Fragment slot="actions">
      {featuredValidators.map((validator, index) => (
        <a
          class={`button ${index === 0 ? "primary" : "ghost"}`}
          href={`/validators/${validator.slug}`}
        >
          Run {validator.title}
        </a>
      ))}
      <a class="button ghost" href="#tools">
        Browse all validators
      </a>
    </Fragment>
  </PageIntro>
  <SummaryCallout
    title="Run one validator before you run them all"
    description="Start with a featured validator to get a report card, then expand into the full menu for deeper coverage."
    takeaways={[
      "Validators translate standards into scorecards and remediation steps.",
      "Each tool links to the mechanisms that close the gap.",
      "Start with the validator that matches your highest-risk touchpoint.",
    ]}
    relatedLinks={[
      { href: "/standards/std-01-temporal-rights", label: "STD-01" },
      { href: "/mechanisms", label: "Mechanisms" },
      { href: "/diagnostics", label: "Diagnostics" },
    ]}
    jumpLinks={[
      { href: "#featured", label: "Featured validators" },
      { href: "#tools", label: "All validators" },
      { href: "#method", label: "Method" },
    ]}
  />
  <p class="muted small">
    Diagnostics help you explore system conditions; validators score those
    conditions against standards and return a pass/fail-style report card.
  </p>
  <div class="callout">
    <h3>Cross-link to rights and mechanisms</h3>
    <p class="muted">
      Jump from validator outputs to the rights they protect and the mechanisms that enforce
      remediation.
    </p>
    <div class="library__role-buttons">
      <a
        class="button primary library__role-button"
        href="/standards/std-01-rights-matrix"
      >
        Open the rights matrix
      </a>
      <a class="button primary library__role-button" href="/mechanisms">
        Browse mechanisms
      </a>
      <a
        class="button primary library__role-button"
        href="/standards/std-01-temporal-rights"
      >
        Review the rights
      </a>
    </div>
  </div>

  <SectionBlock
    id="featured"
    eyebrow="Start here"
    title="Featured validators for a fast report card."
    description="Run one of these first to get a quick score and remediation path."
    variant="alt"
  >
    <CardGrid className="grid--two">
      {
        featuredValidators.map((validator) => (
          <CardItem
            eyebrow={validator.id}
            title={validator.title}
            description={validator.description}
          >
            <a
              slot="footer"
              class="button ghost button--compact"
              href={`/validators/${validator.slug}`}
            >
              Run {validator.title}
            </a>
          </CardItem>
        ))
      }
    </CardGrid>
  </SectionBlock>

  <SectionBlock
    id="focus"
    eyebrow="Browse by focus"
    title="Pick the validator that matches your highest-risk touchpoint."
    description="Use these focus groups to scan the right validator quickly."
  >
    <CardGrid className="grid--two">
      {
        focusGroups.map((group) => (
          <CardItem title={group.title} description={group.description}>
            <ul class="muted">
              {group.validators.map((validator) => (
                <li>
                  <a href={`/validators/${validator.slug}`}>
                    {validator.id}: {validator.title}
                  </a>
                </li>
              ))}
            </ul>
          </CardItem>
        ))
      }
    </CardGrid>
  </SectionBlock>

  <section id="tools" class="section">
    <CardGrid className="grid--two">
      {
        validators.map((validator) => (
          <CardItem
            eyebrow={validator.id}
            title={validator.title}
            description={validator.description}
          >
            <a
              slot="footer"
              class="muted"
              href={`/validators/${validator.slug}`}
            >
              Run {validator.title}
            </a>
          </CardItem>
        ))
      }
    </CardGrid>
  </section>

  <section id="method" class="section section--alt">
    <div class="section__header">
      <p class="eyebrow">Method</p>
      <h2>{method.title}</h2>
      <p class="muted">{method.description}</p>
    </div>
    <ul class="validator-method">
      {method.steps.map((step) => <li>{step}</li>)}
    </ul>
  </section>
  <script
    type="application/ld+json"
    nonce={cspNonce}
    set:html={structuredDataJson}
    is:inline
  />
</BaseLayout>
