---
import BaseLayout from "../../layouts/BaseLayout.astro";
import PageIntro from "../../components/PageIntro.astro";
import CardGrid from "../../components/CardGrid.astro";
import CardItem from "../../components/CardItem.astro";
import { validatorsContent } from "../../content/validators";

const {
  pageTitle,
  pageDescription,
  permalink,
  anchorLinks,
  panelCopy,
  validators,
  method,
} = validatorsContent;
const featuredValidators = validators.slice(0, 2);
const { cspNonce } = Astro.locals;
const pageUrl = Astro.site
  ? new URL(permalink, Astro.site).toString()
  : permalink;
const validatorUrl = (slug: string) =>
  Astro.site
    ? new URL(`/validators/${slug}`, Astro.site).toString()
    : `/validators/${slug}`;
const structuredData = {
  "@context": "https://schema.org",
  "@type": "CollectionPage",
  "@id": pageUrl,
  name: pageTitle,
  description: pageDescription,
  url: pageUrl,
  hasPart: validators.map((validator) => ({
    "@type": "CreativeWork",
    name: `${validator.id} â€” ${validator.title}`,
    description: validator.description,
    url: validatorUrl(validator.slug),
    identifier: validator.id,
  })),
};
const structuredDataJson = JSON.stringify(structuredData, null, 2);
---

<BaseLayout title={pageTitle} description={pageDescription}>
  <PageIntro
    eyebrow="Validators"
    title="Validators"
    description="Run diagnostic validators that output report cards and corrective mechanisms."
    permalink={permalink}
    anchorLinks={anchorLinks}
    panelCopy={panelCopy}
  >
    <Fragment slot="actions">
      {featuredValidators.map((validator, index) => (
        <a
          class={`button ${index === 0 ? "primary" : "ghost"}`}
          href={`/validators/${validator.slug}`}
        >
          Run {validator.title}
        </a>
      ))}
      <a class="button ghost" href="#tools">
        Browse all validators
      </a>
    </Fragment>
  </PageIntro>
  <div class="callout">
    <h3>Cross-link to rights and mechanisms</h3>
    <p class="muted">
      Jump from validator outputs to the rights they protect and the mechanisms that enforce
      remediation.
    </p>
    <div class="library__role-buttons">
      <a
        class="button primary library__role-button"
        href="/standards/std-01-rights-matrix"
      >
        Open the rights matrix
      </a>
      <a class="button primary library__role-button" href="/mechanisms">
        Browse mechanisms
      </a>
      <a
        class="button primary library__role-button"
        href="/standards/std-01-temporal-rights"
      >
        Review the rights
      </a>
    </div>
  </div>

  <section id="tools" class="section">
    <CardGrid className="grid--two">
      {
        validators.map((validator) => (
          <CardItem
            eyebrow={validator.id}
            title={validator.title}
            description={validator.description}
          >
            <a
              slot="footer"
              class="muted"
              href={`/validators/${validator.slug}`}
            >
              Run {validator.title}
            </a>
          </CardItem>
        ))
      }
    </CardGrid>
  </section>

  <section id="method" class="section section--alt">
    <div class="section__header">
      <p class="eyebrow">Method</p>
      <h2>{method.title}</h2>
      <p class="muted">{method.description}</p>
    </div>
    <ul class="validator-method">
      {method.steps.map((step) => <li>{step}</li>)}
    </ul>
  </section>
  <script
    type="application/ld+json"
    nonce={cspNonce}
    set:html={structuredDataJson}
    is:inline
  />
</BaseLayout>
