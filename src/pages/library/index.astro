---
import BaseLayout from '../../layouts/BaseLayout.astro';
import PageIntro from '../../components/PageIntro.astro';
import CardGrid from '../../components/CardGrid.astro';
import CardItem from '../../components/CardItem.astro';
import PatternFilter from '../../components/PatternFilter.astro';
import SectionBlock from '../../components/SectionBlock.astro';
import { diagnosticsContent } from '../../content/diagnostics';
import { libraryContent } from '../../content/library';

const { pageTitle, pageDescription, permalink, primer, glossary, patterns, syllabus } = libraryContent;
const diagnosticTitles = Object.fromEntries(
  diagnosticsContent.tools.map((tool) => [tool.slug, tool.title])
);
const glossaryHref = (slug: string) => `${glossary.permalink}#${slug}`;
---
<BaseLayout title={pageTitle} description={pageDescription}>
  <PageIntro
    eyebrow="Library"
    title="Library"
    description={pageDescription}
    permalink={permalink}
    anchorLinks={[
      { href: '#themes', label: 'Browse by theme' },
      { href: '#primer', label: 'Primer' },
      { href: '#glossary', label: 'Glossary' },
      { href: '#patterns', label: 'Pattern language' },
      { href: '#syllabus', label: 'Syllabus' },
    ]}
    panelCopy={{
      eyebrow: 'How to use this shelf',
      title: 'Structured, linkable content',
      description:
        'Every entry ships with stable permalinks so you can cite them in research reports, design docs, and diagnostics. Filters call out whether a pattern is governance-first, design-ethics guidance, or a policy control to keep collaboration fast.',
    }}
  />

  <SectionBlock
    id="themes"
    eyebrow="Browse by theme"
    title="Jump directly to the work you need."
    description="Use tags to pre-filter the pattern language and keep links aligned with glossary anchors."
  >
    <div class="tag-rail">
      <ul class="pill-list pill-list--wrap">
        {patterns.filters.map((filter) => (
          <li class="pill-list__item tag-rail__item">
            <a
              class="pill-list__button"
              href={`#${filter.slug}`}
              aria-label={`Jump to ${filter.label} materials`}
            >
              {filter.label}
            </a>
            <p class="muted small tag-rail__description">{filter.description}</p>
          </li>
        ))}
      </ul>
      <p class="muted tag-rail__hint">Tags also work as filters in the pattern language below.</p>
    </div>
  </SectionBlock>

  <SectionBlock
    id="primer"
    eyebrow="Primer"
    title="Start here before diving into patterns."
    description="Short overviews you can link inside onboarding decks and briefings."
    variant="alt"
  >
    <CardGrid>
      {primer.map((entry) => (
        <CardItem title={entry.title} description={entry.summary} tags={entry.takeaways} />
      ))}
    </CardGrid>
  </SectionBlock>

  <SectionBlock
    id="glossary"
    eyebrow="Glossary"
    title="Stable terms with per-entry permalinks."
    description="Use these anchors in Field Notes, Research, and Diagnostics so teams share the same language."
  >
    <CardGrid>
      {glossary.terms.map((term) => (
        <CardItem
          id={term.slug}
          eyebrow="Glossary term"
          title={term.term}
          description={term.definition}
        >
          <p class="muted">
            <strong>Useful in:</strong> {term.appliesTo.join(', ')}
          </p>
          <a slot="footer" class="muted" href={glossaryHref(term.slug)}>
            Permalink to {term.term}
          </a>
        </CardItem>
      ))}
    </CardGrid>
    <p class="muted glossary__cta">
      Explore the full glossary in the dedicated section: <a href={glossary.permalink}>/glossary</a>
    </p>
  </SectionBlock>

  <SectionBlock
    id="patterns"
    eyebrow="Pattern language"
    title="Governance, design ethics, and policy patterns with diagnostic links."
    description="Filters help you route work quickly and keep diagnostic references within reach."
    variant="alt"
  >
    <div class="pattern-filter__anchors" aria-hidden="true">
      {patterns.filters.map((filter) => (
        <span class="pattern-filter__anchor" id={filter.slug} />
      ))}
    </div>
    <PatternFilter
      filters={patterns.filters}
      entries={patterns.entries}
      diagnosticTitles={diagnosticTitles}
    />
  </SectionBlock>

  <SectionBlock
    id="syllabus"
    eyebrow="Syllabus"
    title="Guided path for teams adopting the library."
    description={syllabus.overview}
  >
    <CardGrid>
      {syllabus.modules.map((module) => (
        <CardItem meta={module.duration} title={module.title} tags={module.topics}>
          <p class="muted">Outcome: {module.outcome}</p>
        </CardItem>
      ))}
    </CardGrid>
  </SectionBlock>
</BaseLayout>
