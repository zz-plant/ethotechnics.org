---
import { getEntry } from "astro:content";
import BaseLayout from "../../layouts/BaseLayout.astro";
import PageIntro from "../../components/PageIntro.astro";
import FieldNotesTabs from "../../components/FieldNotesTabs.astro";

const fieldNotesEntry = (await getEntry("fieldNotes", "field-notes"))!;
const {
  pageTitle,
  pageDescription,
  permalink,
  sections,
  entries,
  latestUpdate,
  cadenceNote,
  highlight,
} = fieldNotesEntry.data;
const anchorLinks = sections.map((section) => ({
  href: `#${section.format}`,
  label: section.title,
}));
---

<BaseLayout title={pageTitle} description={pageDescription}>
  <Fragment slot="head">
    <link
      rel="alternate"
      type="application/rss+xml"
      href="/field-notes/rss.xml"
      title="Field Notes RSS"
    />
  </Fragment>
  <PageIntro
    eyebrow="Field Notes"
    title="Field Notes"
    description={pageDescription}
    permalink={permalink}
    anchorLinks={anchorLinks}
    panelCopy={{
      eyebrow: "Glossary cross-links",
      title: "Every note links back to Library terms.",
      description:
        "Dispatches, case studies, and signals point to glossary anchors so teams can reuse definitions across research and diagnostics.",
    }}
  />
  <p class="muted small">
    Latest update{" "}
    {
      new Date(latestUpdate).toLocaleDateString("en-US", {
        month: "short",
        year: "numeric",
      })
    }
    .
  </p>
  <p class="muted small">{cadenceNote}</p>
  <p class="muted small">
    Subscribe via <a href="/field-notes/rss.xml">RSS</a>.
  </p>
  <div class="callout field-notes__highlight">
    <p class="eyebrow">Latest highlight</p>
    <h2>{highlight.title}</h2>
    <p class="muted">{highlight.summary}</p>
    <p>{highlight.whyItMatters}</p>
    <a class="button ghost" href={highlight.href}>
      {highlight.ctaLabel}
    </a>
  </div>
  <FieldNotesTabs sections={sections} entries={entries} />
</BaseLayout>
