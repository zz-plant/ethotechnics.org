---
import BaseLayout from "../../layouts/BaseLayout.astro";
import PageIntro from "../../components/PageIntro.astro";
import SectionBlock from "../../components/SectionBlock.astro";
import CardGrid from "../../components/CardGrid.astro";
import CardItem from "../../components/CardItem.astro";
import { standardsContent } from "../../content/standards";

const {
  pageTitle,
  pageDescription,
  permalink,
  anchorLinks,
  panelCopy,
  standards,
  doctrine,
} = standardsContent;
const pageUrl = Astro.site
  ? new URL(permalink, Astro.site).toString()
  : permalink;
const standardsUrl = (slug: string) =>
  Astro.site
    ? new URL(`/standards/${slug}`, Astro.site).toString()
    : `/standards/${slug}`;
const structuredData = {
  "@context": "https://schema.org",
  "@type": "CollectionPage",
  "@id": pageUrl,
  name: pageTitle,
  description: pageDescription,
  url: pageUrl,
  hasPart: [
    ...standards.map((standard) => ({
      "@type": "CreativeWork",
      name: `${standard.id} â€” ${standard.title}`,
      description: standard.description,
      url: standardsUrl(standard.slug),
      identifier: standard.id,
      version: standard.version,
      datePublished: standard.published,
    })),
    ...doctrine.map((item) => ({
      "@type": "CreativeWork",
      name: item.title,
      description: item.description,
      url: Astro.site ? new URL(item.href, Astro.site).toString() : item.href,
    })),
  ],
};
const structuredDataJson = JSON.stringify(structuredData, null, 2);
---

<BaseLayout
  title={pageTitle}
  description={pageDescription}
>
  <PageIntro
    eyebrow="Standards"
    title="Standards"
    description="Immutable doctrine, ratified rights, and canonical definitions for accountable systems."
    permalink={permalink}
    anchorLinks={anchorLinks}
    panelCopy={panelCopy}
  />

  <SectionBlock
    id="active"
    eyebrow="Active standard"
    title="Now active"
    description="Drafts and ratified standards in the publication queue."
  >
    <CardGrid className="grid--two">
      {standards.map((standard) => (
        <CardItem
          eyebrow={standard.id}
          title={standard.title}
          description={standard.description}
        >
          <a
            slot="footer"
            class="muted"
            href={`/standards/${standard.slug}`}
          >
            Read {standard.id}
          </a>
        </CardItem>
      ))}
    </CardGrid>
  </SectionBlock>

  <SectionBlock
    id="doctrine"
    eyebrow="Doctrine"
    title="Core doctrine"
    description="Supporting doctrine and canonical references that accompany the standards."
    variant="alt"
  >
    <CardGrid className="grid--two">
      {doctrine.map((item) => (
        <CardItem
          eyebrow={item.eyebrow}
          title={item.title}
          description={item.description}
        >
          <a slot="footer" class="muted" href={item.href}>
            {item.ctaLabel}
          </a>
        </CardItem>
      ))}
    </CardGrid>
  </SectionBlock>
  <script type="application/ld+json" set:html={structuredDataJson} />
</BaseLayout>
