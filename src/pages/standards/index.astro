---
import BaseLayout from "../../layouts/BaseLayout.astro";
import PageIntro from "../../components/PageIntro.astro";
import SectionBlock from "../../components/SectionBlock.astro";
import CardGrid from "../../components/CardGrid.astro";
import CardItem from "../../components/CardItem.astro";
import { standardsContent } from "../../content/standards";

const {
  pageTitle,
  pageDescription,
  permalink,
  anchorLinks,
  panelCopy,
  standards,
  doctrine,
} = standardsContent;
const { cspNonce } = Astro.locals;
const pageUrl = Astro.site
  ? new URL(permalink, Astro.site).toString()
  : permalink;
const standardsUrl = (slug: string) =>
  Astro.site
    ? new URL(`/standards/${slug}`, Astro.site).toString()
    : `/standards/${slug}`;
const structuredData = {
  "@context": "https://schema.org",
  "@type": "CollectionPage",
  "@id": pageUrl,
  name: pageTitle,
  description: pageDescription,
  url: pageUrl,
  hasPart: [
    ...standards.map((standard) => ({
      "@type": "CreativeWork",
      name: `${standard.id} — ${standard.title}`,
      description: standard.description,
      url: standardsUrl(standard.slug),
      identifier: standard.id,
      version: standard.version,
      datePublished: standard.published,
    })),
    ...doctrine.map((item) => ({
      "@type": "CreativeWork",
      name: item.title,
      description: item.description,
      url: Astro.site ? new URL(item.href, Astro.site).toString() : item.href,
    })),
  ],
};
const structuredDataJson = JSON.stringify(structuredData, null, 2);
---

<BaseLayout title={pageTitle} description={pageDescription}>
  <PageIntro
    eyebrow="Standards"
    title="Standards"
    description={pageDescription}
    permalink={permalink}
    anchorLinks={anchorLinks}
    panelCopy={panelCopy}
  />

  <SectionBlock
    id="active"
    eyebrow="Active standards"
    title="Now active"
    description="Drafts and ratified standards in the publication queue."
  >
    <CardGrid className="grid--two">
      {
        standards.map((standard) => (
          <CardItem
            eyebrow={standard.id}
            title={standard.title}
            description={standard.description}
          >
            {standard.id === "STD-02" && (
              <p class="muted">
                Practice:{" "}
                <a href="/standards/ethotechnics-for-agents">
                  Ethotechnics for Agents
                </a>{" "}
                — Mechanism-first practice for implementing STD-01 and STD-02 in
                real agent systems.
              </p>
            )}
            <a slot="footer" class="muted" href={`/standards/${standard.slug}`}>
              Read {standard.id}
            </a>
          </CardItem>
        ))
      }
    </CardGrid>
  </SectionBlock>

  <SectionBlock
    id="doctrine"
    eyebrow="Doctrine"
    title="Core doctrine"
    description="Supporting doctrine and canonical references that accompany the standards."
    variant="alt"
  >
    <CardGrid className="grid--two">
      {
        doctrine.map((item) => (
          <CardItem
            eyebrow={item.eyebrow}
            title={item.title}
            description={item.description}
          >
            <a slot="footer" class="muted" href={item.href}>
              {item.ctaLabel}
            </a>
          </CardItem>
        ))
      }
    </CardGrid>
  </SectionBlock>

  <SectionBlock
    id="referenced-by"
    eyebrow="Referenced by"
    title="Where standards are enforced"
    description="Cross-links keep standards, bindings, and evidence packs aligned."
  >
    <div class="grid grid--three">
      <div class="panel">
        <p class="eyebrow">Used in examples</p>
        <ul class="muted">
          <li>
            <a href="/examples/automated-account-lock">Automated account lock</a
            >
          </li>
          <li>
            <a href="/examples/content-moderation-takedown"
              >Content moderation takedown</a
            >
          </li>
          <li>
            <a href="/examples/automated-eligibility-denial"
              >Automated eligibility denial</a
            >
          </li>
        </ul>
      </div>
      <div class="panel">
        <p class="eyebrow">Required by bindings</p>
        <ul class="muted">
          <li>
            <a href="/bindings#procurement">Procurement clauses</a>
          </li>
          <li>
            <a href="/bindings#release-gates">Release gate checklist</a>
          </li>
          <li>
            <a href="/bindings#runbooks">Runbook snippets</a>
          </li>
        </ul>
      </div>
      <div class="panel">
        <p class="eyebrow">Verified by evidence packs</p>
        <ul class="muted">
          <li>
            <a href="/evidence-packs/std-01">STD-01 Evidence Pack</a>
          </li>
          <li>
            <a href="/evidence-packs/std-02">STD-02 Evidence Pack</a>
          </li>
          <li>
            <a href="/validators">Validators (VAL-01–VAL-03)</a>
          </li>
        </ul>
      </div>
    </div>
    <p class="muted">
      Bundles:
      {" "}
      <a href="/bundles/procurement-clause-pack">Procurement Clause Pack</a>
      {" "}
      and
      {" "}
      <a href="/bundles/diagnostic-export-kit">Diagnostic Export Kit</a>.
    </p>
    <p class="muted">
      Search IDs: STD-01 v1.0, STD-02 v0.9, STD-03 v0.6, STD-01.1.1, STD-02.2.1,
      VAL-01, VAL-02, VAL-03.
    </p>
  </SectionBlock>
  <script
    type="application/ld+json"
    nonce={cspNonce}
    set:html={structuredDataJson}
    is:inline
  />
</BaseLayout>
