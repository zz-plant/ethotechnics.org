---
import BaseLayout from "../../layouts/BaseLayout.astro";
import CitationBlock from "../../components/CitationBlock.astro";
import DiagnosticMethodology from "../../components/DiagnosticMethodology.astro";
import PageIntro from "../../components/PageIntro.astro";
import ScholarlyMeta from "../../components/ScholarlyMeta.astro";
import SectionBlock from "../../components/SectionBlock.astro";
import StudioOffRampCallout from "../../components/StudioOffRampCallout.astro";
import { diagnosticsContent } from "../../content/diagnostics";
import MaintenanceSimulatorWidget from "../../features/maintenance-simulator";

const tool = diagnosticsContent.tools.find(
  (entry) => entry.slug === "maintenance-simulator"
);

if (!tool) {
  return Astro.response(
    new Response("Diagnostic not found", {
      status: 404,
    })
  );
}

const { publication } = diagnosticsContent;
const { offRampCallout } = diagnosticsContent;
const pageTitle = `${tool.title} â€” Diagnostics`;
const pageDescription = tool.description;
const permalink = `/diagnostics/${tool.slug}`;
const anchorLinks = [
  { href: "#overview", label: "Overview" },
  { href: "#methodology", label: "Methodology" },
  { href: "#sample-output", label: "Sample output" },
  { href: "#run-tool", label: "Run the tool" },
];
---

<BaseLayout
  title={pageTitle}
  description={pageDescription}
  mainClass="page page--wide"
>
  <PageIntro
    eyebrow="Diagnostics"
    title={tool.title}
    description={pageDescription}
    permalink={permalink}
    anchorLinks={anchorLinks}
    panelCopy={{
      eyebrow: "What you receive",
      title: "Tabletop-ready maintenance outputs.",
      description: tool.outputs.join(" "),
    }}
  />
  <ScholarlyMeta publication={publication} permalink={permalink} />
  <CitationBlock
    title={tool.title}
    permalink={permalink}
    publication={publication}
    citationKey={`diagnostic_${tool.slug}`}
  />

  <SectionBlock
    id="overview"
    eyebrow="Overview"
    title="When to use the Maintenance Simulator."
    description={tool.bestFor}
  >
    <ul class="muted">
      {tool.prepChecklist.map((item) => (
        <li>{item}</li>
      ))}
    </ul>
    <p class="muted">Estimated time: {tool.estimatedTime}</p>
    <StudioOffRampCallout {...offRampCallout} />
  </SectionBlock>

  <SectionBlock
    id="methodology"
    eyebrow="Methodology"
    title="Method, transparency, and replicability."
    description="Inputs, scoring logic, validation notes, and failure modes used in the tabletop."
    variant="alt"
  >
    <DiagnosticMethodology
      methodCards={tool.methodCards}
      methodOverview={tool.methodOverview}
      instrument={tool.instrument}
      validation={tool.validation}
      replicability={tool.replicability}
    />
  </SectionBlock>

  <SectionBlock
    id="sample-output"
    eyebrow="Sample output"
    title="Preview a simulated run."
    description="Use the sample output to see the summary format and comms templates."
  >
    <a class="button ghost" href={tool.exampleHref}>
      {tool.exampleLabel}
    </a>
  </SectionBlock>

  <SectionBlock
    id="run-tool"
    eyebrow="Run the tool"
    title="Start a maintenance scenario."
    description="Run the tabletop and export the summary for your maintenance packet."
    variant="alt"
  >
    <MaintenanceSimulatorWidget client:only="react" />
  </SectionBlock>
</BaseLayout>
