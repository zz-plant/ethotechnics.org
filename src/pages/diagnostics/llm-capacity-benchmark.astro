---
import BaseLayout from "../../layouts/BaseLayout.astro";
import CitationBlock from "../../components/CitationBlock.astro";
import DiagnosticMethodology from "../../components/DiagnosticMethodology.astro";
import PageIntro from "../../components/PageIntro.astro";
import ReferenceCallout from "../../components/ReferenceCallout.astro";
import ScholarlyMeta from "../../components/ScholarlyMeta.astro";
import SectionBlock from "../../components/SectionBlock.astro";
import { diagnosticsStudioOffRampCallout } from "../../content/callouts";
import { diagnosticsContent } from "../../content/diagnostics";

const tool = diagnosticsContent.tools.find(
  (entry) => entry.slug === "llm-capacity-benchmark"
);

if (!tool) {
  return Astro.response(
    new Response("Diagnostic not found", {
      status: 404,
    })
  );
}

const { publication } = diagnosticsContent;
const pageTitle = `${tool.title} â€” Diagnostics`;
const pageDescription = tool.description;
const permalink = `/diagnostics/${tool.slug}`;
const anchorLinks = [
  { href: "#overview", label: "Overview" },
  { href: "#methodology", label: "Methodology" },
  { href: "#sample-output", label: "Sample output" },
  { href: "#request", label: "Request via Studio" },
];
---

<BaseLayout title={pageTitle} description={pageDescription}>
  <PageIntro
    eyebrow="Diagnostics"
    title={tool.title}
    description={pageDescription}
    permalink={permalink}
    anchorLinks={anchorLinks}
  />

  <SectionBlock
    id="overview"
    eyebrow="Overview"
    title="When to use the LLM Capacity Benchmark."
    description={tool.bestFor}
  >
    <ul class="muted">
      {tool.prepChecklist.map((item) => (
        <li>{item}</li>
      ))}
    </ul>
    <p class="muted">Estimated time: {tool.estimatedTime}</p>
    <ReferenceCallout
      title={diagnosticsStudioOffRampCallout.title}
      summary={diagnosticsStudioOffRampCallout.summary}
      href={diagnosticsStudioOffRampCallout.href}
      linkLabel={diagnosticsStudioOffRampCallout.linkLabel}
      ariaLabel={diagnosticsStudioOffRampCallout.ariaLabel}
    />
    {tool.studioNote && <p class="muted small">{tool.studioNote}</p>}
  </SectionBlock>
  <ScholarlyMeta publication={publication} permalink={permalink} />
  <CitationBlock
    title={tool.title}
    permalink={permalink}
    publication={publication}
    citationKey={`diagnostic_${tool.slug}`}
  />

  <SectionBlock
    id="methodology"
    eyebrow="Methodology"
    title="Method, transparency, and replicability."
    description="Inputs, scoring logic, validation notes, and failure modes used in the benchmark."
    variant="alt"
  >
    <DiagnosticMethodology
      methodCards={tool.methodCards}
      methodOverview={tool.methodOverview}
      instrument={tool.instrument}
      validation={tool.validation}
      replicability={tool.replicability}
    />
  </SectionBlock>

  <SectionBlock
    id="sample-output"
    eyebrow="Sample output"
    title="Preview a benchmark summary."
    description="Review the readiness scorecard and mitigation notes."
  >
    <a class="button ghost" href={tool.exampleHref}>
      {tool.exampleLabel}
    </a>
  </SectionBlock>

  <SectionBlock
    id="request"
    eyebrow="Request via Studio"
    title="Schedule a facilitated benchmark."
    description="We run the benchmark with you and deliver the linked readout."
    variant="alt"
  >
    <a class="button primary" href={tool.ctaHref} aria-label={tool.ctaAriaLabel ?? tool.ctaLabel}>
      {tool.ctaLabel}
    </a>
  </SectionBlock>
</BaseLayout>
