---
import { getEntry } from "astro:content";
import CardGrid from "../../components/CardGrid.astro";
import CardItem from "../../components/CardItem.astro";
import PageIntro from "../../components/PageIntro.astro";
import SectionBlock from "../../components/SectionBlock.astro";
import BaseLayout from "../../layouts/BaseLayout.astro";
import { quickStartGuides } from "../../content/quick-start";

const startHereData = (await getEntry("startHere", "start-here"))!;
const {
  pageTitle,
  pageDescription,
  permalink,
  hero,
  anchorLinks,
  routes,
  decisionGuide,
  artifacts,
  quickStart,
  framing,
  studio,
  footerCta,
} = startHereData.data;
const recommendedCard = routes.cards.find((card) => card.recommendedTag);
const recommendedDetails = recommendedCard
  ? [
      { text: recommendedCard.recommendedNote, className: "muted" },
      { text: recommendedCard.bestFor, className: "muted small" },
      { text: recommendedCard.time, className: "muted small" },
      { text: recommendedCard.description, className: "muted small" },
    ].filter((detail) => detail.text)
  : [];
---

<BaseLayout title={pageTitle} description={pageDescription}>
  <PageIntro
    eyebrow={hero.eyebrow}
    title={hero.heading}
    description={hero.description}
    permalink={permalink}
    anchorLinks={anchorLinks}
    panelCopy={hero.panel}
  />
  {
    recommendedCard && (
      <div class="callout">
        <p class="eyebrow">Recommended first step</p>
        <h3>{recommendedCard.title}</h3>
        {recommendedDetails.map((detail) => (
          <p class={detail.className}>{detail.text}</p>
        ))}
        <div class="section__actions">
          {hero.actions.map((action) => (
            <a
              class={`button ${action.variant}`}
              href={action.href}
              aria-label={action.ariaLabel ?? action.label}
            >
              {action.label}
            </a>
          ))}
        </div>
      </div>
    )
  }
  <p class="muted small">{hero.quickNote}</p>
  <p class="muted">{hero.quickSummary}</p>
  <ul class="muted">
    {hero.deliverables.map((item) => <li>{item}</li>)}
  </ul>

  <SectionBlock
    id="routes"
    eyebrow={routes.eyebrow}
    title={routes.title}
    description={routes.description}
    className="section--banded"
  >
    <CardGrid className="grid--two">
      {
        routes.cards.map((card) => (
          <CardItem
            title={card.title}
            description={card.description}
            descriptionTone="default"
            tags={
              card.recommendedTag
                ? [card.recommendedTag, ...card.tags]
                : card.tags
            }
          >
            {card.recommendedNote && (
              <p class="muted small">{card.recommendedNote}</p>
            )}
            <p class="muted">{card.bestFor}</p>
            <p class="muted small">{card.time}</p>
            <div slot="footer" class="card__footer">
              <a
                class="button ghost button--compact"
                href={card.href}
                aria-label={`Go to ${card.title}`}
              >
                Visit {card.title.toLowerCase()}
              </a>
            </div>
          </CardItem>
        ))
      }
    </CardGrid>
  </SectionBlock>

  <SectionBlock
    id="artifacts"
    eyebrow={artifacts.eyebrow}
    title={artifacts.title}
    description={artifacts.description}
    variant="alt"
  >
    <CardGrid className="grid--two">
      {
        artifacts.previews.map((preview) => (
          <CardItem
            title={preview.title}
            description={preview.description}
            descriptionTone="default"
          >
            <p class="muted">{preview.note}</p>
            <div slot="footer" class="card__footer">
              <a
                class="button primary button--compact"
                href={preview.href}
                aria-label={preview.label}
              >
                {preview.label}
              </a>
            </div>
          </CardItem>
        ))
      }
    </CardGrid>
  </SectionBlock>

  <SectionBlock
    id="quick-start"
    eyebrow={quickStart.eyebrow}
    title={quickStart.title}
    description={quickStart.description}
  >
    <CardGrid className="grid--two">
      {quickStartGuides.map((guide) => (
        <CardItem
          title={guide.title}
          description={guide.summary}
          descriptionTone="default"
        >
          <ul class="muted">
            {guide.focusAreas.map((area) => (
              <li>{area}</li>
            ))}
          </ul>
          <div slot="footer" class="card__footer">
            <a class="button ghost button--compact" href={`/quick-start/${guide.slug}`}>
              Open {guide.title.toLowerCase()} guide
            </a>
          </div>
        </CardItem>
      ))}
    </CardGrid>
  </SectionBlock>

  <SectionBlock
    id="framing"
    eyebrow={framing.eyebrow}
    title={framing.title}
    description={framing.description}
  >
    <CardGrid className="grid--two">
      <CardItem title="This page is" descriptionTone="default">
        <ul class="muted">
          {framing.isList.map((item) => <li>{item}</li>)}
        </ul>
      </CardItem>
      <CardItem title="This page is not" descriptionTone="default">
        <ul class="muted">
          {framing.isNotList.map((item) => <li>{item}</li>)}
        </ul>
      </CardItem>
    </CardGrid>
  </SectionBlock>

  <SectionBlock
    id="decision-guide"
    eyebrow={decisionGuide.eyebrow}
    title={decisionGuide.title}
    description={decisionGuide.description}
    className="section--banded"
  >
    <CardGrid className="grid--three">
      {
        decisionGuide.prompts.map((prompt) => (
          <CardItem
            title={prompt.question}
            description={prompt.answer}
            descriptionTone="default"
          >
            <div slot="footer" class="card__footer">
              <a
                class="button ghost button--compact"
                href={prompt.href}
                rel={prompt.href.startsWith("http") ? "noreferrer" : undefined}
                target={prompt.href.startsWith("http") ? "_blank" : undefined}
              >
                {prompt.label}
              </a>
            </div>
          </CardItem>
        ))
      }
    </CardGrid>
  </SectionBlock>

  <SectionBlock
    id="studio"
    eyebrow={studio.eyebrow}
    title={studio.title}
    description={studio.description}
    className="section--banded"
  >
    <CardGrid>
      <CardItem descriptionTone="default">
        <ul class="muted">
          {studio.bullets.map((bullet) => <li>{bullet}</li>)}
        </ul>
        <div class="card__footer">
          <a
            class="button ghost"
            href={studio.ctaHref}
            aria-label={studio.ctaAriaLabel}
            rel="noreferrer"
          >
            {studio.ctaLabel}
          </a>
        </div>
      </CardItem>
    </CardGrid>
  </SectionBlock>

  <SectionBlock
    id="cta"
    eyebrow={footerCta.eyebrow}
    title={footerCta.title}
    description={footerCta.description}
    variant="alt"
  >
    <div class="section__actions">
      <a class="button primary" href={footerCta.primaryHref}>
        {footerCta.primaryLabel}
      </a>
      <a class="button ghost" href={footerCta.secondaryHref}>
        {footerCta.secondaryLabel}
      </a>
    </div>
  </SectionBlock>
</BaseLayout>
