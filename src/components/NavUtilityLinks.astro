---
import { Icon } from "astro-icon/components";

interface NavUtilityLink {
  href: string;
  label: string;
  class: string;
  rel?: string;
  target?: string;
  icon?: string;
}

const navUtilityLinks: NavUtilityLink[] = [
  {
    href: "https://github.com/zz-plant/ethotechnics",
    label: "GitHub",
    class: "button ghost button--compact",
    rel: "noopener noreferrer",
    target: "_blank",
    icon: "lucide:github",
  },
  {
    href: "/participate#feedback",
    label: "Send feedback",
    class: "button ghost button--compact",
    icon: "lucide:message-circle",
  },
  {
    href: "https://ethotechnics.com/studio",
    label: "Ethotechnics Studio",
    class: "nav__utility-link",
    rel: "noopener noreferrer",
    target: "_blank",
    icon: "lucide:arrow-up-right",
  },
];

const { links = navUtilityLinks, currentPath } = Astro.props as {
  links?: NavUtilityLink[];
  currentPath?: string;
};

const normalizePath = (path?: string) => {
  if (!path) return "";

  const [clean] = path.split("#");

  if (!clean) return "";

  const trimmed =
    clean.endsWith("/") && clean !== "/" ? clean.slice(0, -1) : clean;

  return trimmed || "/";
};

const normalizedCurrentPath = normalizePath(currentPath);
const isCurrentLink = (href: string) => {
  if (!href.startsWith("/")) return false;

  return normalizePath(href) === normalizedCurrentPath;
};
---

{
  links.map((link) => (
    <a
      class={link.class}
      href={link.href}
      rel={link.rel}
      target={link.target}
      aria-current={isCurrentLink(link.href) ? "page" : undefined}
    >
      <span>{link.label}</span>
      {link.icon && (
        <Icon class="nav__icon" name={link.icon} aria-hidden="true" />
      )}
    </a>
  ))
}

<style>
  .nav__utility-link {
    display: inline-flex;
    align-items: center;
    gap: 0.35rem;
    padding: 0.6rem 0.85rem;
    border-radius: 10px;
    border: 1px solid color-mix(in srgb, var(--border) 82%, transparent);
    background: color-mix(in srgb, var(--surface) 96%, white 4%);
    color: var(--text);
    font-weight: 700;
    text-decoration: none;
    box-shadow: 0 6px 14px rgba(64, 52, 40, 0.08);
    transition:
      transform 0.16s ease,
      border-color 0.16s ease;
  }

  .nav__utility-link:hover,
  .nav__utility-link:focus-visible {
    border-color: color-mix(in srgb, var(--accent) 32%, var(--border));
    transform: translateY(-1px);
  }

  .nav__utility-link:focus-visible {
    outline: 2px solid var(--accent-strong);
    outline-offset: 2px;
    box-shadow: 0 0 0 6px color-mix(in srgb, var(--accent) 22%, transparent);
  }

  .nav__icon {
    width: 1.05rem;
    height: 1.05rem;
    opacity: 0.7;
  }

  .nav__icon :global([data-icon]) {
    width: 100%;
    height: 100%;
    display: block;
  }

  @media (any-pointer: coarse) {
    .nav__utility-link {
      min-height: 2.9rem;
      padding-inline: 0.85rem;
    }
  }
</style>
