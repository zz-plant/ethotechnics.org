---
import type { NavSection } from '../content/navigation';

const { sections, class: className, currentPath } = Astro.props as {
  sections: NavSection[];
  class?: string;
  currentPath?: string;
};

const normalizePath = (path?: string) => {
  if (!path) return '';

  const [clean] = path.split('#');

  if (!clean) return '';

  const trimmed = clean.endsWith('/') && clean !== '/' ? clean.slice(0, -1) : clean;

  return trimmed || '/';
};

const normalizedCurrentPath = normalizePath(currentPath);
const sectionWrapperClass = ['nav__section', className].filter(Boolean).join(' ');
const isCurrentLink = (href: string) => {
  if (!href.startsWith('/')) return false;

  return normalizePath(href) === normalizedCurrentPath;
};
const toSlug = (value: string) =>
  value
    .toLowerCase()
    .replace(/[^a-z0-9]+/g, '-')
    .replace(/(^-|-$)/g, '');
---
{sections.map((section) => {
  const sectionId = `nav-section-${toSlug(section.heading)}`;

  return (
    <section class={sectionWrapperClass} aria-labelledby={`${sectionId}-title`}>
      <header class="nav__section-header">
        <p class="eyebrow nav__section-eyebrow" id={`${sectionId}-title`}>
          {section.heading}
        </p>
        <p class="muted nav__section-description">{section.description}</p>
      </header>
      <ul class="nav__section-links" aria-labelledby={`${sectionId}-title`}>
        {section.links.map((link) => (
          <li class="nav__section-item">
            <a
              class="nav__link-card"
              href={link.href}
              aria-current={isCurrentLink(link.href) ? 'page' : undefined}
            >
              <span class="nav__link-label">{link.label}</span>
              {link.description && (
                <span class="muted nav__link-description">{link.description}</span>
              )}
            </a>
          </li>
        ))}
      </ul>
    </section>
  );
})}
