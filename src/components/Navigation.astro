---
import { Icon } from 'astro-icon/components';
import NavUtilityLinks from './NavUtilityLinks.astro';
import { libraryContent } from '../content/library';
import navigationScript from '../scripts/navigation.ts?url';

const navCollections = [
  {
    heading: 'Explore',
    description: 'Reference materials tuned for fast sharing and reuse.',
    links: [
      {
        href: '/library',
        label: 'Library',
        description: 'Primers, patterns, and syllabus modules with stable permalinks.',
      },
      {
        href: '/glossary',
        label: 'Glossary',
        description: 'Shared vocabulary for moral system design and governance.',
      },
      {
        href: '/field-notes',
        label: 'Field notes',
        description: 'Applied notes and walkthroughs from ongoing research.',
      },
    ],
  },
  {
    heading: 'Programs',
    description: 'Initiatives led by the Institute and collaborators.',
    links: [
      {
        href: '/institute',
        label: 'Institute',
        description: 'Training cohorts, facilitation kits, and stewardship guidance.',
      },
      {
        href: '/research',
        label: 'Research',
        description: 'Agenda, collaborations, and studies shaping the library.',
      },
      {
        href: '/finite',
        label: 'Finite [Beta]',
        description: 'Stoppability drills and evaluations for AI-enabled systems.',
      },
    ],
  },
  {
    heading: 'Diagnostics',
    description: 'Benchmarks, measurements, and system health checks.',
    links: [
      {
        href: '/diagnostics',
        label: 'Diagnostics',
        description: 'Reliability and burden modeling tools you can run today.',
      },
    ],
  },
];

const navTags = libraryContent.patterns.filters.map((filter) => ({
  href: `${libraryContent.permalink}#${filter.slug}`,
  label: filter.label,
}));

const navContentId = 'site-navigation-content';
---
<nav class="nav" aria-label="Primary" data-astro-transition-persist data-nav>
  <div class="nav__inner container">
    <div class="nav__bar">
      <a href="/" class="nav__brand" aria-label="Go to the homepage">
        Ethotechnics
      </a>

      <div class="nav__utility nav__utility--desktop">
        <NavUtilityLinks />
      </div>

      <button
        class="nav__toggle"
        aria-expanded="false"
        aria-controls={navContentId}
        aria-label="Open navigation"
        type="button"
      >
        <span class="nav__toggle-label">Menu</span>
        <span class="nav__toggle-icon" aria-hidden="true">
          <span class="nav__toggle-bar"></span>
          <span class="nav__toggle-bar"></span>
          <span class="nav__toggle-bar"></span>
        </span>
      </button>
    </div>

    <div class="nav__content" id={navContentId} aria-hidden="true" hidden inert>
      <div class="nav__content-body">
        <div class="nav__content-header">
          <div class="nav__content-title">
            <p class="eyebrow">Navigation</p>
            <p class="muted">Find Ethotechnics resources, programs, and diagnostics in one place.</p>
          </div>
          <div class="nav__utility nav__utility--desktop">
            <NavUtilityLinks />
          </div>
        </div>
        <div class="nav__content-grid">
          <div class="nav__primary">
            {navCollections.map((section) => (
              <section class="nav__section">
                <div class="nav__section-header">
                  <p class="eyebrow nav__section-eyebrow">{section.heading}</p>
                  <p class="muted nav__section-description">{section.description}</p>
                </div>
                <ul class="nav__section-links">
                  {section.links.map((link) => (
                    <li class="nav__section-item">
                      <a class="nav__link-card" href={link.href}>
                        <span class="nav__link-label">{link.label}</span>
                        <span class="muted nav__link-description">{link.description}</span>
                      </a>
                    </li>
                  ))}
                </ul>
              </section>
            ))}
          </div>
          <div class="nav__secondary">
            <div class="nav__quick-links" aria-label="Library themes">
              <p class="muted nav__quick-links-label">Top library tags</p>
              <ul class="pill-list">
                {navTags.map((tag) => (
                  <li class="pill-list__item">
                    <a class="pill-list__button" href={tag.href}>{tag.label}</a>
                  </li>
                ))}
              </ul>
            </div>
            <div class="nav__actions">
              <a class="button primary" href="/institute">Join the Institute</a>
              <a class="button ghost" href="/field-notes">Read field notes</a>
              <a class="button ghost button--compact" href="https://signals.ethotechnics.org" rel="noreferrer" target="_blank">
                Signals newsletter
                <Icon class="nav__icon" name="lucide:arrow-up-right" aria-hidden="true" />
              </a>
            </div>
          </div>
        </div>
        <div class="nav__utility nav__utility--menu">
          <NavUtilityLinks />
        </div>
      </div>
    </div>
  </div>

  <div class="nav__scrim" hidden aria-hidden="true"></div>

  <noscript>
    <div class="nav__fallback container">
      {navCollections.map((section) => (
        <section class="nav__section">
          <div class="nav__section-header">
            <p class="eyebrow nav__section-eyebrow">{section.heading}</p>
            <p class="muted nav__section-description">{section.description}</p>
          </div>
          <ul class="nav__section-links">
            {section.links.map((link) => (
              <li class="nav__section-item">
                <a class="nav__link-card" href={link.href}>
                  <span class="nav__link-label">{link.label}</span>
                  <span class="muted nav__link-description">{link.description}</span>
                </a>
              </li>
            ))}
          </ul>
        </section>
      ))}
      <div class="nav__quick-links" aria-label="Library themes">
        <p class="muted nav__quick-links-label">Top library tags</p>
        <ul class="pill-list">
          {navTags.map((tag) => (
            <li class="pill-list__item">
              <a class="pill-list__button" href={tag.href}>{tag.label}</a>
            </li>
          ))}
        </ul>
      </div>
      <div class="nav__utility nav__utility--menu">
        <NavUtilityLinks />
      </div>
      <div class="nav__actions">
        <a class="button primary" href="/institute">Join the Institute</a>
        <a class="button ghost" href="/field-notes">Read field notes</a>
        <a class="button ghost button--compact" href="https://signals.ethotechnics.org" rel="noreferrer" target="_blank">
          Signals newsletter
          <Icon class="nav__icon" name="lucide:arrow-up-right" aria-hidden="true" />
        </a>
      </div>
    </div>
  </noscript>
</nav>

<script type="module" src={navigationScript}></script>
