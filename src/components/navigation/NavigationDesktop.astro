---
import Logo from "../Logo.astro";
import NavSectionList from "../NavSectionList.astro";
import NavUtilityLinks from "../NavUtilityLinks.astro";
import Search from "../Search.astro";
import Wordmark from "../Wordmark.astro";
import type { NavLink, NavSection } from "../../content/navigation";
import { isCurrentLink, normalizePath, toViewTransitionName } from "../../utils/navigation";

interface Props {
  currentPath: string;
  desktopExploreId: string;
  desktopLinks: NavLink[];
  navSections: NavSection[];
}

const { currentPath, desktopExploreId, desktopLinks, navSections } =
  Astro.props as Props;
const isHome = normalizePath(currentPath) === "/";
---

<div class="nav__bar">
  <a
    href="/"
    class="nav__brand"
    aria-label="Go to the homepage"
    aria-current={isHome ? "page" : undefined}
    style="view-transition-name: nav-brand;"
  >
    <Logo class="nav__brand-logo" title="Ethotechnics" />
    <Wordmark class="nav__wordmark" ariaHidden={true} />
  </a>

  <div class="nav__search-desktop">
    <Search scope="desktop" />
  </div>

  <div class="nav__links nav__links--desktop" aria-label="Primary">
    {
      desktopLinks.map((link) => (
        <a
          class="nav__link"
          href={link.href}
          aria-current={isCurrentLink(link.href, currentPath) ? "page" : undefined}
          style={`view-transition-name: ${toViewTransitionName(
            link.href,
            "desktop",
          )};`}
        >
          {link.label}
        </a>
      ))
    }
  </div>

  <div class="nav__explore">
    <button
      class="nav__explore-toggle"
      type="button"
      aria-expanded="false"
      aria-controls={desktopExploreId}
      aria-haspopup="dialog"
      data-explore-toggle
    >
      <span class="nav__explore-toggle-label">Explore</span>
      <span class="nav__explore-toggle-icon" aria-hidden="true">â†—</span>
    </button>
    <dialog
      class="nav__explore-panel"
      id={desktopExploreId}
      aria-labelledby="desktop-explore-title"
      data-explore-dialog
    >
      <div class="nav__explore-panel-inner">
        <div class="nav__explore-header">
          <div class="nav__explore-title">
            <p class="eyebrow" id="desktop-explore-title">
              Explore
            </p>
            <p class="muted">Browse every section in one place.</p>
          </div>
          <button class="nav__explore-close" type="button" data-explore-close>
            Close
          </button>
        </div>
        <div class="nav__explore-grid">
          <NavSectionList
            sections={navSections}
            currentPath={currentPath}
            class="nav__section--explore"
          />
        </div>
      </div>
    </dialog>
  </div>

  <div class="nav__utility nav__utility--desktop">
    <NavUtilityLinks currentPath={currentPath} />
  </div>
</div>
