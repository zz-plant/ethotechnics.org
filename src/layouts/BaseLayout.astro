---
import { SEO } from 'astro-seo';
import { ClientRouter } from 'astro:transitions';
import Navigation from '../components/Navigation.astro';
import '../styles/global.css';
import '@fontsource-variable/plus-jakarta-sans';
import '@fontsource-variable/source-serif-4';

interface Props {
  title?: string;
  description?: string;
}

const {
  title = 'Ethotechnics — Ethical technology in practice',
  description = 'Ethotechnics.org explores how to build technology that respects human dignity through design, research, and governance.',
} = Astro.props as Props;
const canonical = Astro.site ? new URL(Astro.url.pathname, Astro.site).toString() : Astro.url.href;
  const siteBase = Astro.site ? Astro.site.toString() : Astro.url.origin;
  const ogImage = new URL('/favicon.svg', siteBase).toString();
  const defaultTitle = 'Ethotechnics — Ethical technology in practice';
---
<!doctype html>
<html lang="en" id="top">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <SEO
      title={title ?? defaultTitle}
      description={description}
      canonical={canonical}
      openGraph={{
        basic: {
          title: title ?? defaultTitle,
          type: 'website',
          image: ogImage,
          url: canonical,
        },
      }}
      twitter={{
        card: 'summary',
        image: ogImage,
      }}
      extend={{
        link: [{ rel: 'icon', type: 'image/svg+xml', href: '/favicon.svg' }],
      }}
    />
  </head>
  <body>
    <a class="skip-link" href="#main-content">Skip to main content</a>
    <ClientRouter fallback="swap" />
    <Navigation />
    <main id="main-content" class="page container" tabindex="-1">
      <slot />
    </main>
    <footer class="footer container" aria-label="Site footer">
      <section class="footer__section">
        <h2 class="eyebrow footer__heading">Identity</h2>
        <div class="footer__identity">
          <a class="footer__brand" href="/" aria-label="Ethotechnics home">
            <img src="/favicon.svg" alt="Ethotechnics logo" class="footer__logo" loading="lazy" />
            <span class="footer__brand-name">Ethotechnics Institute</span>
          </a>
          <p class="muted">Content licensed under the Creative Commons Attribution 4.0 International License.</p>
          <a
            class="footer__link"
            href="https://creativecommons.org/licenses/by/4.0/"
            rel="noreferrer"
            target="_blank"
          >
            View the CC BY 4.0 license
          </a>
        </div>
      </section>
      <section class="footer__section">
        <h2 class="eyebrow footer__heading">Network</h2>
        <ul class="footer__list">
          <li><a class="footer__link" href="/institute">Ethotechnics Institute</a></li>
          <li>
            <a class="footer__link" href="https://ethotechnics.com" rel="noreferrer" target="_blank">
              Ethotechnics Studio
            </a>
          </li>
          <li>
            <a class="footer__link" href="https://syadvada.org" rel="noreferrer" target="_blank">Syadvada</a>
          </li>
        </ul>
      </section>
      <section class="footer__section">
        <h2 class="eyebrow footer__heading">Connect</h2>
        <ul class="footer__list">
          <li>
            <a class="footer__link" href="https://signals.ethotechnics.org" rel="noreferrer" target="_blank">
              Signals newsletter
            </a>
          </li>
          <li><a class="footer__link" href="/rss.xml">RSS feed</a></li>
          <li>
            <a class="footer__link" href="https://github.com/ethotechnics" rel="noreferrer" target="_blank">
              Ethotechnics on GitHub
            </a>
          </li>
        </ul>
      </section>
    </footer>
    <script>
      const main = document.getElementById('main-content');

      const focusMainAfterTransition = () => {
        requestAnimationFrame(() => {
          main?.focus();
        });
      };

      document.addEventListener('astro:after-swap', focusMainAfterTransition);
    </script>
  </body>
</html>
